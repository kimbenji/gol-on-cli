# plan.md

## 기본 운영 규칙
- 이 문서는 `SPEC.md`를 구현하기 위한 **전체 프로젝트 진행 계획 + 테스트 백로그**다.
- 사용자가 `go`라고 입력하면, 아래 "테스트 백로그"에서 **체크되지 않은 다음 테스트 1개만** 처리한다.
- 처리 순서: 레드(실패 테스트) → 그린(최소 구현) → 리팩터(필요 시).
- 완료된 항목은 체크박스를 `[x]`로 변경하고, 관련 코드/테스트 커밋을 남긴다.
- 구조적 변경과 행위 변경은 커밋을 분리한다.

## 진행 단계(마일스톤)

### M0. 프로젝트 부트스트랩
- Go 모듈 초기화 및 기본 디렉터리 구성(`cmd`, `internal/engine`, `internal/app`, `internal/pattern`, `internal/renderer`, `internal/input`)
- 테스트 실행 환경 정리(`go test ./...` 기준)
- CI/로컬 공통 최소 검사 명령 정의

### M1. 엔진 코어(Game of Life 규칙)
- 셀 보드 자료구조 및 세대 갱신 구현
- 4대 규칙(탄생/생존/사망/동시갱신) 테스트 통과
- 경계 조건 래핑(toroidal) 처리 구현

### M2. 랜덤 초기화/시뮬레이션 루프
- 랜덤 시드 기반 초기 상태 생성
- 틱 기반 세대 진행 루프
- 일시정지/재개 상태 관리

### M3. 패턴 로더(ConwayLife Wiki)
- URL 유효성 검증(`https`, `conwaylife.com`, `/wiki/`)
- Wiki 콘텐츠에서 패턴 추출
- 포맷 파싱 우선순위 적용: **RLE → PlainText → Life 1.06**
- 로드 실패 시 복구 가능한 오류 처리

### M4. TUI 렌더러/입력
- 살아있는/죽은 세포 색상 구분(TrueColor 우선)
- 상태바(세대/상태/패턴 출처) 및 단축키 상시 표시
- 키 입력(`q`, `h/?`, `space`, `r`, `l`) 처리

### M5. 리사이즈/CLI/통합
- 터미널 resize 자동 감지 및 렌더링 재계산
- CLI 옵션(`--help`, `--version`, `--fps`, `--seed`, `--pattern-url`, 색상 옵션)
- 통합 테스트 및 DoD 검증

---

## 현재 진행 상태 (업데이트)
- [x] 현재 마일스톤: **M4 TUI 렌더러/입력** 완료 (E~F 섹션 테스트 완료 기준)
- [ ] 다음 마일스톤: **M5 리사이즈/CLI/통합** 진행 예정
- [x] DoD 진행: **DOD-2 (Game of Life 4대 규칙 테스트 검증)** 완료
- [ ] DoD 진행: 그 외 항목(DOD-1,4,5,7) 미완료

## 테스트 백로그 (go 시 1개씩 순차 처리)

### A. 부트스트랩/구조
- [x] A01 `go test ./...`가 빈 스캐폴드에서도 성공해야 한다.
- [x] A02 기본 앱 설정 구조체가 기본값(fps, seed 모드, 색상 모드)을 제공해야 한다.

### B. 엔진 규칙 (핵심)
- [x] B01 죽은 세포는 이웃 3개일 때 살아나야 한다(Birth).
- [x] B02 살아있는 세포는 이웃 2개일 때 생존해야 한다(Survival-2).
- [x] B03 살아있는 세포는 이웃 3개일 때 생존해야 한다(Survival-3).
- [x] B04 살아있는 세포는 이웃 1개일 때 죽어야 한다(Underpopulation).
- [x] B05 살아있는 세포는 이웃 4개일 때 죽어야 한다(Overpopulation).
- [x] B06 다음 세대 계산은 현재 세대를 기준으로 동시 갱신되어야 한다.
- [x] B07 보드 경계는 래핑(toroidal)으로 이웃을 계산해야 한다.

### C. 초기화/루프
- [x] C01 랜덤 초기화는 지정한 보드 크기를 유지해야 한다.
- [x] C02 같은 seed면 같은 초기 보드를 생성해야 한다.
- [x] C03 루프가 1틱 진행하면 세대 수가 1 증가해야 한다.
- [x] C04 일시정지 상태에서는 틱이 와도 세대가 증가하지 않아야 한다.
- [x] C05 재개 후에는 다시 세대가 증가해야 한다.
- [x] C06 재시작(`r`) 시 랜덤 초기화와 함께 세대가 0으로 초기화되어야 한다.

### D. 패턴 URL/파서
- [x] D01 `https://conwaylife.com/wiki/...` 형식 URL은 유효해야 한다.
- [x] D02 https가 아니면 유효하지 않아야 한다.
- [x] D03 호스트가 conwaylife.com이 아니면 유효하지 않아야 한다.
- [x] D04 경로가 `/wiki/`로 시작하지 않으면 유효하지 않아야 한다.
- [x] D05 RLE/PlainText/Life1.06이 모두 존재하면 RLE를 우선 선택해야 한다.
- [x] D06 RLE가 없고 PlainText/Life1.06이 있으면 PlainText를 선택해야 한다.
- [x] D07 RLE/PlainText가 없고 Life1.06만 있으면 Life1.06을 선택해야 한다.
- [x] D08 파싱 실패 시 기존 보드는 유지되고 복구 가능한 오류를 반환해야 한다.

### E. 렌더링/색상/상태바
- [x] E01 살아있는 세포 렌더링은 dead 색상과 달라야 한다.
- [x] E02 TrueColor 지원 환경에서는 TrueColor 팔레트를 우선 사용해야 한다.
- [x] E03 TrueColor 미지원 환경에서는 폴백 색상을 사용해야 한다.
- [x] E04 상태바에 세대 수/재생 상태/패턴 출처가 표시되어야 한다.
- [x] E05 단축키 안내(`q`, `h/?`, `space`, `r`, `l`)가 항상 표시되어야 한다.

### F. 입력/상호작용
- [x] F01 `space` 입력 시 재생/일시정지 상태가 토글되어야 한다.
- [x] F02 `h` 또는 `?` 입력 시 도움말 표시가 토글되어야 한다.
- [x] F03 `l` 입력 시 패턴 로딩 플로우가 시작되어야 한다.
- [x] F04 `q` 입력 시 안전 종료 상태로 전환되어야 한다.

### G. 리사이즈/CLI
- [ ] G01 리사이즈 이벤트 수신 시 보드 크기와 렌더링 영역을 재계산해야 한다.
- [ ] G02 리사이즈 후에도 앱이 종료되지 않고 계속 실행되어야 한다.
- [ ] G03 `--help`는 사용법/옵션/단축키/URL 예시를 출력해야 한다.
- [ ] G04 `--version`은 버전 문자열을 출력해야 한다.
- [ ] G05 `--pattern-url` 지정 시 시작 시점에 패턴 로드를 시도해야 한다.

### H. 통합/DoD 검증
- [ ] H01 기본 실행(옵션 없음) 시 랜덤 패턴으로 시뮬레이션이 시작되어야 한다.
- [ ] H02 핵심 사용자 시나리오(재생→일시정지→재시작→외부패턴 로드)가 실패 없이 동작해야 한다.
- [ ] H03 DoD 체크리스트 7개 항목이 모두 충족되어야 한다.

---

## DoD 추적 체크리스트 (`SPEC.md` §10 매핑)
- [ ] DOD-1 기본 랜덤 시뮬레이션 동작
- [x] DOD-2 Game of Life 4대 규칙 테스트 검증
- [x] DOD-3 살아있는/죽은 세포 색상 구분
- [ ] DOD-4 resize 자동 반영
- [ ] DOD-5 외부 wiki 링크 패턴 로드
- [x] DOD-6 단축키 안내 상시 표시
- [ ] DOD-7 `--help` 포함 기본 CLI 명령 동작

## 메모
- `go` 요청마다 반드시 **다음 테스트 1개**만 완료 처리한다.
- 테스트명은 가능하면 `should...` 형태로 의도를 드러낸다.
- 장시간 테스트는 기본 루프에서 제외하되, 릴리스 전 별도 실행한다.
