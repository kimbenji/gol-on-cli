# gol-on-cli 작업 명세서

## 1. 문서 목적
본 문서는 `gol-on-cli` 프로젝트의 1차 구현 범위, 필수 제약, 사용자 경험, 확장성을 정의한다.  
프로젝트 목표는 **Conway의 Game of Life를 CLI 환경에서 스크린세이버처럼 동작하는 TUI 애플리케이션**으로 제공하는 것이다.

---

## 2. 강제 제약사항 (절대 위반 불가)

1. Conway의 Game of Life 규칙은 원문 의미 그대로 구현한다.
2. 애플리케이션은 Go 언어로 작성한다.
3. 렌더링은 TUI 프레임워크 기반으로 구현한다.
4. 살아있는 세포와 죽은 세포는 색상으로 명확히 구분한다.
5. 실행 중 터미널 화면 크기 변경을 자동 감지하고 즉시 반영한다.
6. 기본 실행은 랜덤 패턴으로 시작한다.
7. 실행 중 사용 가능한 단축키(종료/동작 전환)를 항상 화면 내 안내한다.
8. `https://conwaylife.com/wiki/` 링크를 입력받아 유효한 패턴 링크이면 해당 패턴을 로드/출력한다.

---

## 3. Game of Life 규칙 정의 (절대 규칙)

모든 세포는 매 세대마다 다음 규칙을 적용한다.

1. **탄생(Birth)**: 죽은 세포의 주변 8칸 이웃 중 살아있는 세포가 정확히 3개면 다음 세대에 살아난다.
2. **생존(Survival)**: 살아있는 세포의 주변 8칸 이웃 중 살아있는 세포가 2개 또는 3개면 다음 세대에도 살아있다.
3. **과소/과밀 사망(Death)**: 살아있는 세포의 살아있는 이웃 수가 2 미만 또는 3 초과면 다음 세대에 죽는다.
4. **동시 갱신(Synchronous Update)**: 모든 세포의 다음 상태는 현재 세대 기준으로 동시에 계산한다.

> 위 규칙은 예외 없이 적용하며, 별도 모드가 추가되더라도 기본 모드의 규칙 변경은 허용하지 않는다.

---

## 4. 제품 목표

- CLI 상에서 장시간 구동 가능한 시각적 스크린세이버 경험 제공
- 외부 패턴(ConwayLife Wiki) 로드 지원
- 사용자가 키보드만으로 제어 가능한 직관적 조작 제공
- 향후 기능 확장(색상 테마, 로딩 소스 추가, 인터랙션 확장)을 고려한 구조 확보

---

## 5. 기능 요구사항

### 5.1 기본 동작
- 앱 실행 시 기본적으로 랜덤 초기 격자를 생성하여 시뮬레이션 시작
- 세대(generation) 단위로 자동 진행
- 현재 상태 정보(세대 수, 재생 상태, 현재 패턴 출처 등) 표시

### 5.2 렌더링/TUI
- 죽은 세포/살아있는 세포를 색상으로 구분
- 색상 렌더링은 TrueColor를 우선 사용
- 화면 전체 또는 지정 가능한 캔버스에 격자 렌더링
- 프레임 업데이트 시 깜빡임을 최소화
- 하단 또는 고정 영역에 단축키 안내를 지속 노출

### 5.3 터미널 크기 자동 반영
- 터미널 resize 이벤트를 감지
- 감지 즉시 격자 크기/렌더링 영역을 재계산
- 재계산 시 앱 비정상 종료 없이 시뮬레이션 지속
- 경계 조건은 래핑(wrapping, toroidal)으로 처리

### 5.4 외부 패턴 링크 입력
- `https://conwaylife.com/wiki/<PatternName>` 형식 링크 입력 지원
- 링크 유효성 검증:
  - 스킴: `https`
  - 호스트: `conwaylife.com`
  - 경로 prefix: `/wiki/`
- 유효 링크면 패턴을 파싱/변환하여 격자에 로드 (파싱 우선순위: RLE → PlainText → Life 1.06)
- 유효하지 않거나 파싱 실패 시 사용자에게 오류 메시지 제공 후 기존 상태 유지

### 5.5 단축키(항상 안내)
최소 필수:
- 종료: `q`
- 도움말/키 안내 토글: `h` 또는 `?`
- 일시정지/재개: `space`
- 재시작(랜덤 초기화): `r`
- 외부 패턴 불러오기: `l`

> 단축키는 상태 바/푸터에 항상 표시한다.

---

## 6. CLI 요구사항

### 6.1 사용자 친화 기본 명령
- `--help`: 사용법, 옵션, 단축키, 링크 입력 예시 출력
- `--version`: 버전 정보 출력

### 6.2 초기 옵션(권장)
- `--fps <n>`: 초당 세대 갱신 속도
- `--seed <n>`: 랜덤 시드 고정
- `--pattern-url <url>`: 시작 시 외부 패턴 로드 시도
- `--alive-color <name|hex>`: 살아있는 세포 색상
- `--dead-color <name|hex>`: 죽은 세포 색상

---

## 7. 옵셔널 요구사항 반영 방침

1. **색상 변경**: 런타임 또는 시작 옵션으로 변경 가능하도록 설계
2. **중간 제어**: 일시정지/초기화/외부 패턴 로딩 지원
3. **추가 요청 수용 구조**: 입력/시뮬레이션/렌더링/패턴로더 모듈 분리
4. **친화 명령 제공**: `--help` 포함 CLI 표준 인터페이스 준수

---

## 8. 아키텍처 제안 (구현 가이드)

### 8.1 모듈 분리
- `engine`: 세포 상태, 다음 세대 계산(순수 로직)
- `renderer`: TUI 렌더링, 색상/화면 크기 반영
- `input`: 키 입력 처리, 명령 라우팅
- `pattern`: 랜덤 생성, 외부 링크 패턴 로드
- `app`: 상태 머신(재생/일시정지/로딩/오류)

### 8.2 확장 포인트
- 패턴 소스 추가(로컬 파일, gist, RLE 직접 입력)
- 테마 프리셋(다크/라이트/고대비)
- 시뮬레이션 규칙 변형 실험 모드(기본 모드와 분리)

---

## 9. 오류 처리 및 안정성

- 외부 링크 로드 실패 시 앱은 계속 동작해야 함
- resize/입력/렌더링 오류는 가능한 범위에서 복구
- 치명 오류 발생 시 사용자에게 원인 메시지를 표시하고 안전 종료

---

## 10. 완료 기준 (Definition of Done)

1. 기본 랜덤 시뮬레이션이 CLI에서 정상 동작한다.
2. Game of Life 4대 규칙이 테스트로 검증된다.
3. 살아있는/죽은 세포 색상 구분이 적용된다.
4. 터미널 resize 시 자동 반영된다.
5. 외부 wiki 링크 입력으로 유효 패턴 로드가 가능하다.
6. 단축키 안내가 화면에 항상 표시된다.
7. `--help` 포함 기본 CLI 명령이 동작한다.

---

## 11. 확정 사항 (요구사항 반영)

아래 항목은 구현 기준으로 확정한다.

1. 외부 wiki 패턴 파싱 우선순위는 **RLE → PlainText → Life 1.06** 순으로 적용한다.
2. 격자 경계 조건은 **래핑(wrapping, toroidal)** 을 사용한다.
3. 색상 표현은 **TrueColor 우선**으로 처리하고, 지원 불가 환경에서는 하위 호환 색상으로 폴백한다.

> 본 문서는 “작업 명세서 선행 작성” 요구와 후속 확정사항 반영을 충족하는 기준 문서다.
